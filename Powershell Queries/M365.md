
# Bulk User Creation and License Management with Microsoft Graph PowerShell

This guide shows you how to **create bulk users** in Microsoft 365 with a **Microsoft 365 Business Standard license** using Microsoft Graph PowerShell, and how to **remove licenses**.

---

## **Prerequisites**
1. **Global Administrator** or **User Administrator** rights in Microsoft 365.
2. **PowerShell 7** installed.
3. **Microsoft Graph PowerShell SDK** installed.

```powershell
Install-Module Microsoft.Graph -Scope CurrentUser -Force
Install-Module Microsoft.Graph.Users -Scope CurrentUser -Force
Install-Module Microsoft.Graph.Licenses -Scope CurrentUser -Force
```

---

## **Step 1: Connect to Microsoft Graph**

```powershell
Import-Module Microsoft.Graph.Users
Import-Module Microsoft.Graph.Licenses

Connect-MgGraph -Scopes "User.ReadWrite.All", "Directory.ReadWrite.All"
```

---

## **Step 2: Identify the Business Standard SKU ID**

```powershell
Get-MgSubscribedSku | Select-Object SkuPartNumber, SkuId
```

Find the **`MICROSOFT 365 BUSINESS STANDARD`** line and copy the `SkuId`.

Example:
```
SkuPartNumber                    SkuId
-------------------------------- ------------------------------------
O365_BUSINESS_PREMIUM           a1b2c3d4-5678-90ab-cdef-112233445566
```

> **Note:** Microsoft 365 Business Standard is often listed as `O365_BUSINESS_PREMIUM`.

---

## **Step 3: Prepare a CSV for Bulk User Creation**

Save a CSV file as `bulk_users.csv` with the following format:

```csv
DisplayName,MailNickname,UserPrincipalName,Password
John Doe,johndoe,johndoe@yourdomain.com,P@ssw0rd123!
Jane Smith,janesmith,janesmith@yourdomain.com,P@ssw0rd123!
```

---

## **Step 4: Bulk Create Users and Assign Licenses**

Replace `YOUR_SKU_ID` with the one you copied earlier.

```powershell
$SkuId = "YOUR_SKU_ID"
$Users = Import-Csv "C:\Path\To\bulk_users.csv"

foreach ($User in $Users) {
    # Create the user
    New-MgUser `
        -AccountEnabled:$true `
        -DisplayName $User.DisplayName `
        -MailNickname $User.MailNickname `
        -UserPrincipalName $User.UserPrincipalName `
        -PasswordProfile @{ ForceChangePasswordNextSignIn = $true; Password = $User.Password }

    # Assign license
    Set-MgUserLicense -UserId $User.UserPrincipalName -AddLicenses @{ SkuId = $SkuId } -RemoveLicenses @()
}
```

---

## **Step 5: Remove License from Users**

```powershell
$SkuId = "YOUR_SKU_ID"
$Users = Import-Csv "C:\Path\To\bulk_users.csv"

foreach ($User in $Users) {
    Set-MgUserLicense -UserId $User.UserPrincipalName -AddLicenses @() -RemoveLicenses @($SkuId)
}
```

---

## **Notes**
- You **must** run PowerShell as Administrator.
- Passwords in the CSV are **temporary** and must meet your organizationâ€™s complexity policy.
- The script forces users to **change their password at first login**.

---

## **References**
- Microsoft Graph PowerShell Docs: [https://learn.microsoft.com/powershell/microsoftgraph/](https://learn.microsoft.com/powershell/microsoftgraph/)
